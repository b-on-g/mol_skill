{
	"project": "Invoicer",
	"prd_path": "bog/mol/invoicer/prd.md",
	"source_module": "bog/mol/invoicer",
	"source_namespace": "$bog_mol_invoicer",
	"entry_point": "bog/mol/invoicer/index.html",

	"agent_instructions": {
		"before_start": [
			"Прочитай этот файл и git log --oneline -20",
			"Прочитай PRD: bog/mol/invoicer/prd.md",
			"Выбери ОДНУ задачу со статусом pending и наивысшим приоритетом",
			"Проверь, что все dependencies этой задачи имеют статус done",
			"Подтяни скил mol (/mol) перед началом работы с $mol кодом"
		],
		"during_work": [
			"Работай только над выбранной задачей",
			"Делай коммиты после каждого логического изменения",
			"Не трогай код, не связанный с текущей задачей",
			"Стили ОБЯЗАТЕЛЬНО через .view.css.ts ($mol_style_define), raw .view.css только для pseudo-elements/hover/attr",
			"Используй $mol_mem для кешируемых свойств, $mol_action для сайд-эффектов",
			"Весь код создаётся в bog/mol/invoicer/ (namespace $bog_mol_invoicer_*)",
			"Точка входа: bog/mol/invoicer/index.html"
		],
		"before_finish": [
			"Проверь билд: открой http://localhost:9080/bog/mol/invoicer/-/test.html",
			"Проверь аудит: curl http://localhost:9080/bog/mol/invoicer/-/web.audit.js",
			"Меняй status на done ТОЛЬКО после успешного прохождения всех тестов",
			"ЗАПРЕЩЕНО удалять или редактировать задачи — только менять status"
		]
	},

	"tasks": [
		{
			"id": "INV-001",
			"category": "functional",
			"priority": "critical",
			"description": "Настраиваемый LLM endpoint: панель настроек с полями URL и API-ключ (OpenAI-совместимый API). Сохранение в localStorage. Фолбэк на текущий GitHub Model.",
			"acceptance_criteria": [
				"В UI появилась секция/панель 'Настройки' (или кнопка-шестерёнка)",
				"Два поля: API URL и API Key",
				"Значения сохраняются в localStorage и восстанавливаются при перезагрузке",
				"Если URL и ключ заданы — LLM-запросы идут на кастомный endpoint",
				"Если пустые — используется текущий GitHub Model (дефолт)",
				"Формат запроса: OpenAI Chat Completions API (POST /v1/chat/completions)",
				"Аудит проходит без ошибок"
			],
			"test_steps": [
				"Шаг 1: Открыть приложение, найти настройки",
				"Шаг 2: Ввести URL (напр. http://localhost:11434/v1) и ключ",
				"Шаг 3: Перезагрузить — значения сохранились",
				"Шаг 4: Вставить реквизиты, нажать 'Распознать' — запрос идёт на кастомный endpoint",
				"Шаг 5: Очистить URL — фолбэк на GitHub Model работает"
			],
			"dependencies": [],
			"status": "pending"
		},
		{
			"id": "INV-002",
			"category": "functional",
			"priority": "critical",
			"description": "Менеджер шаблонов: загрузка DOCX-шаблонов с плейсхолдерами ({{company_name}}, {{inn}} и т.д.), хранение в localStorage/IndexedDB, выбор шаблона при выгрузке.",
			"acceptance_criteria": [
				"Секция 'Шаблоны' в UI",
				"Кнопка загрузки DOCX-шаблона",
				"Список загруженных шаблонов с возможностью удаления",
				"Выбор активного шаблона (radio/select)",
				"Встроенный дефолтный шаблон 'Акт выполненных работ' (текущий HTML-шаблон)",
				"При выгрузке: подстановка значений реквизитов в плейсхолдеры {{...}}",
				"Поддержка плейсхолдеров: company_name, inn, kpp, ogrn, legal_address, bank_name, bik, account, corr_account, director, phone, email, date, signature",
				"Выгрузка заполненного DOCX",
				"Шаблоны сохраняются между сессиями",
				"Аудит проходит без ошибок"
			],
			"test_steps": [
				"Шаг 1: Загрузить DOCX-шаблон с плейсхолдерами",
				"Шаг 2: Шаблон появился в списке",
				"Шаг 3: Выбрать загруженный шаблон",
				"Шаг 4: Заполнить реквизиты (вручную или через парсинг)",
				"Шаг 5: Нажать 'Скачать DOC' — получить DOCX с подставленными реквизитами",
				"Шаг 6: Перезагрузить — шаблон всё ещё в списке",
				"Шаг 7: Удалить шаблон — исчез из списка"
			],
			"dependencies": [],
			"status": "done"
		},
		{
			"id": "INV-003",
			"category": "ui",
			"priority": "high",
			"description": "UX-улучшения: индикатор загрузки при парсинге, валидация полей (ИНН 10/12 цифр, БИК 9 цифр, счета 20 цифр), кнопка 'Очистить всё'.",
			"acceptance_criteria": [
				"Спиннер/индикатор при вызове LLM",
				"Валидация ИНН (10 или 12 цифр), БИК (9 цифр), р/с и к/с (20 цифр)",
				"Ошибки валидации отображаются под полем",
				"Кнопка 'Очистить' сбрасывает все поля",
				"Аудит проходит без ошибок"
			],
			"test_steps": [
				"Шаг 1: Нажать 'Распознать' — виден индикатор загрузки",
				"Шаг 2: Ввести невалидный ИНН (5 цифр) — показывается ошибка",
				"Шаг 3: Ввести валидный ИНН (10 цифр) — ошибки нет",
				"Шаг 4: Заполнить все поля, нажать 'Очистить' — все поля пустые"
			],
			"dependencies": [],
			"status": "pending"
		},
		{
			"id": "INV-004",
			"category": "infrastructure",
			"priority": "high",
			"description": "Docker Compose для локальной установки: nginx + статика приложения + Ollama с моделью. Работает без интернета после первого запуска.",
			"acceptance_criteria": [
				"docker-compose.yml в корне invoicer/",
				"Сервис web: nginx со статикой из -/ (собранный бандл)",
				"Сервис llm: Ollama с предустановленной моделью (qwen2.5:7b или аналог)",
				"Приложение автоматически настроено на локальный Ollama endpoint",
				"docker compose up поднимает всё, доступно на localhost:8080",
				"После первого запуска работает без интернета",
				"README с инструкцией по установке"
			],
			"test_steps": [
				"Шаг 1: docker compose up -d",
				"Шаг 2: Открыть localhost:8080",
				"Шаг 3: Вставить реквизиты, нажать 'Распознать'",
				"Шаг 4: Реквизиты распознаны (через локальную Ollama)",
				"Шаг 5: Отключить интернет — всё работает"
			],
			"dependencies": ["INV-001"],
			"status": "done"
		},
		{
			"id": "INV-005",
			"category": "functional",
			"priority": "medium",
			"description": "Telegram Mini App: полный UI инвойсера внутри Telegram. Пользователь открывает бота, грузит реквизиты, получает документ.",
			"acceptance_criteria": [
				"Telegram бот с кнопкой 'Открыть приложение' (Mini App)",
				"Mini App отображает тот же UI инвойсера",
				"Загрузка файлов работает через Telegram File API",
				"Результат можно скачать прямо в чат",
				"Бот-обёртка: принимает файл → отдаёт документ (fallback без Mini App)"
			],
			"test_steps": [
				"Шаг 1: Открыть бота в Telegram",
				"Шаг 2: Нажать 'Открыть приложение'",
				"Шаг 3: В Mini App загрузить PDF с реквизитами",
				"Шаг 4: Распознать, выбрать шаблон, скачать документ",
				"Шаг 5: Отправить PDF боту напрямую — получить документ в ответ"
			],
			"dependencies": ["INV-001", "INV-002"],
			"status": "pending"
		},
		{
			"id": "INV-006",
			"category": "bug-fix",
			"priority": "critical",
			"description": "Кнопка настроек (шестерёнка) не открывает попап с полями LLM URL и API Key. Settings_popup не появляется при клике на Settings_toggle.",
			"acceptance_criteria": [
				"Клик по шестерёнке открывает попап с настройками LLM",
				"Повторный клик закрывает попап",
				"Поля URL и API Key доступны и редактируемы",
				"Аудит проходит без ошибок"
			],
			"test_steps": [
				"Шаг 1: Открыть приложение",
				"Шаг 2: Кликнуть на шестерёнку в тулбаре",
				"Шаг 3: Попап с настройками LLM открылся",
				"Шаг 4: Кликнуть ещё раз — попап закрылся"
			],
			"dependencies": [],
			"status": "pending"
		}
	]
}
