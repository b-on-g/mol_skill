# Progress Log — Invoicer

## Инструкции для агентов

Каждый агент после завершения задачи ОБЯЗАН добавить запись в этот файл в формате:

```
## [INV-XXX] Название задачи
**Дата:** YYYY-MM-DD HH:MM
**Статус:** done | blocked | partial

### Что сделано
- Пункт 1
- Пункт 2

### Тесты
- [x] Тест 1 — прошёл
- [x] Тест 2 — прошёл

### Заметки (опционально)
Любые важные наблюдения для следующих агентов.

---
```

## Контекст проекта

- **PRD:** `bog/mol/invoicer/prd.md`
- **Задачи:** `bog/mol/invoicer/tasks.json`
- **Модуль:** `bog/mol/invoicer/`
- **Namespace:** `$bog_mol_invoicer`
- **Билд:** `cd /Users/cmyser/code/mam && npm exec mam bog/mol/invoicer`
- **Аудит:** `bog/mol/invoicer/-/web.audit.js`
- **Dev:** `http://localhost:9080/bog/mol/invoicer/-/test.html`

---

## [INV-002] Менеджер шаблонов DOCX
**Дата:** 2026-02-27
**Статус:** done

### Что сделано
- Добавлена секция Templates_section с заголовком "Шаблоны документов"
- Реализована кнопка загрузки DOCX-шаблонов (Templates_upload)
- Реализован список загруженных шаблонов с кнопкой удаления (Template_row)
- Добавлен выбор активного шаблона через $mol_select (Templates_select_picker)
- Встроенный дефолтный шаблон "Акт выполненных работ" сохранён
- Реализована подстановка плейсхолдеров {{company_name}}, {{inn}}, {{kpp}} и др.
- Хранение шаблонов в IndexedDB (класс $bog_mol_invoicer_template_db)
- Обработка DOCX через JSZip (класс $bog_mol_invoicer_docx)
- Сохранение выбранного шаблона в localStorage

### Тесты
- [x] Загрузка DOCX-шаблона — работает
- [x] Шаблон появляется в списке — работает
- [x] Выбор шаблона через select — работает
- [x] Скачивание заполненного DOCX — работает
- [x] Сохранение между сессиями (IndexedDB) — работает
- [x] Удаление шаблона — работает
- [x] Аудит — Audit passed

### Заметки
- Исправлена ошибка TS2344: bubble_content $mol_pop должен быть обёрнут в массив `/`
- Исправлена ошибка TS2344: options для $mol_select должен быть `/string` (массив), а не `*` (объект)
- Задача INV-001 (LLM endpoint) уже была реализована в предыдущих коммитах — код присутствует в view.tree/view.ts

---

## [INV-004] Docker Compose для локальной установки
**Дата:** 2026-02-27
**Статус:** done

### Что сделано
- Создан docker-compose.yml с сервисами web (nginx) и llm (Ollama)
- Создан Dockerfile для nginx со статикой из -/
- Создан nginx.conf для обслуживания SPA с gzip-сжатием
- Сервис llm-init автоматически загружает модель qwen2.5:7b при первом запуске
- Создан README.md с инструкцией по установке и использованию
- Данные Ollama сохраняются в Docker volume для работы без интернета

### Тесты
- [x] docker-compose.yml создан — присутствует
- [x] Dockerfile создан — присутствует
- [x] nginx.conf создан — присутствует
- [x] README.md создан — присутствует
- [x] Аудит — Audit passed

### Заметки
- Для использования необходимо сначала собрать статику: `npm exec mam bog/mol/invoicer`
- После первого запуска и загрузки модели (~4.5 GB) приложение работает офлайн
- Настройки LLM для локальной Ollama: URL = `http://localhost:11434/v1`, API Key пустой
- Используется curlimages/curl для загрузки модели через API, так как OLLAMA_HOST не работает в отдельном контейнере

---

## [INV-007] Проверка билда и аудита, коммит и пуш
**Дата:** 2026-02-27
**Статус:** done

### Что сделано
- Проверен билд — web.audit.js содержит "Audit passed"
- Обновлён статус задачи INV-007 в tasks.json на done
- Все изменения закоммичены и запушены в main

### Тесты
- [x] web.audit.js содержит Audit passed — подтверждено
- [x] Билд без ошибок TS — подтверждено

### Заметки
- Задача INV-006 (баг с попапом настроек) всё ещё в статусе pending, но код для Settings_popup присутствует в view.tree и view.ts
- Рекомендуется проверить работу попапа вручную в браузере

---
